# S3 Support

Furman includes a full-featured S3 client that works with any S3-compatible storage — AWS, MinIO, Backblaze B2, Cloudflare R2, DigitalOcean Spaces, Wasabi, and dozens more.

## Connecting

Press **Cmd+S** to open the S3 connection dialog. You can authenticate using:
- **AWS profile** — uses profiles from `~/.aws/credentials`
- **Access key / secret key** — stored securely in macOS Keychain
- **Default credentials** — uses the default AWS credential chain
- **IAM role assumption** — assume a role via STS with configurable external ID and session duration
- **Anonymous access** — browse public buckets without any credentials

Furman ships with a built-in database of 38 S3-compatible providers (sourced from Cyberduck) with 179 regional endpoints. When you select a provider, the endpoint and region are auto-filled and provider-specific capabilities are configured automatically.

Saved connections appear in the sidebar for quick access with provider icons. Press **Cmd+S** again while connected to disconnect.

### Transfer Acceleration

For AWS S3 buckets with Transfer Acceleration enabled, check the **Transfer Acceleration** option in the connection dialog to use accelerated endpoints for faster uploads and downloads.

## Browsing & Navigation

- Browse buckets and objects with standard dual-pane navigation
- Create folders and rename objects
- Create and delete buckets (from the bucket list in the connection dialog, Cmd+S)
- Search objects by name within a bucket (**Cmd+F**)
- Quick filter works the same as local panels — just start typing

## Transfers

- **Download** (S3 → local) and **upload** (local → S3) with drag-and-drop or Copy/Move commands
- **S3-to-S3 copy** between different connections
- **Multipart upload** for large files (>8 MiB) with concurrent parts and automatic retries
- **Transfer queue** with configurable concurrency (1–5 simultaneous transfers)
- **Pause / resume** with checkpointing — interrupted transfers pick up where they left off
- **Transfer speed** displayed with smoothed (EMA) calculation
- **Bandwidth limiting** — throttle transfer speed via Preferences (configurable limit in bytes/sec)
- **Transfer panel** (Cmd+J) — always toggleable to monitor active and completed transfers

### Sync

Press **Cmd+Y** to sync between local and S3 panels (or between two S3 panels). The sync dialog shows a diff view of all changes and lets you select which files to transfer.

- **Comparison modes** — size/modification time (fast) or ETag/checksum (accurate)
- **Exclude patterns** — comma-separated glob patterns to skip files (default: `.DS_Store, Thumbs.db, .git/**`), persisted across sessions
- **Bidirectional** — sync in either direction between local ↔ S3 or S3 ↔ S3

## Object Operations

| Shortcut | Action |
|----------|--------|
| Cmd+U | Generate presigned URL (copy to clipboard) |
| Cmd+K | Copy S3 URI (`s3://bucket/key`) to clipboard |
| Cmd+L | Bulk storage class change for selected objects |
| Cmd+I / F9 | Properties (single object) or Batch Edit (multiple objects) |

### Storage Class

Change storage class for individual objects (via Properties) or in bulk (Cmd+L). Supported classes: `STANDARD`, `STANDARD_IA`, `ONEZONE_IA`, `INTELLIGENT_TIERING`, `GLACIER`, `GLACIER_IR`, `DEEP_ARCHIVE`.

### Glacier Restore

Objects in Glacier/Deep Archive storage classes can be restored from the Properties dialog with configurable restore duration and retrieval tier (Standard, Bulk, Expedited).

### Versioning

View, download, restore, or delete individual object versions from the Properties dialog (expandable section).

### Metadata & Tags

From the Properties dialog (single object):
- **Object metadata** — edit Content-Type, Content-Disposition, Cache-Control, Content-Encoding, and custom metadata key-value pairs
- **Object tags** — edit up to 10 tags per object
- **Bucket tags** — edit up to 50 tags per bucket

### Batch Metadata & Tag Editing

Select multiple objects and press **Cmd+I / F9** to open the batch edit dialog:
- **Metadata tab** — set Content-Type, Content-Disposition, Cache-Control, Content-Encoding, and custom metadata across all selected objects. Only non-empty fields are applied.
- **Tags tab** — set tags on all selected objects with two modes:
  - **Replace all** — overwrites existing tags with the new set
  - **Merge with existing** — preserves existing tags, new tags override by key (fails if merged count exceeds 10)
- **Progress bar** with object count, current filename, and **Cancel** button
- **Results summary** showing succeeded/failed counts with expandable failed keys list

### Object Lock

Furman supports S3 Object Lock for WORM (Write Once Read Many) compliance:

**Bucket-level** (from bucket Properties):
- Enable/disable Object Lock on the bucket
- Set default retention mode (Governance or Compliance) and period (days or years)

**Object-level** (from object Properties):
- **Retention** — set Governance or Compliance retention with a retain-until date. Bypass governance option available for privileged users.
- **Legal hold** — toggle legal hold ON/OFF per object
- **Bulk retention** — apply the same retention settings to multiple selected objects at once

## Client-Side Encryption

Furman can encrypt files on your machine before uploading to S3. This ensures data is encrypted at rest even if you don't trust the storage provider.

### How It Works

1. **Upload** — when encryption is active, each file is encrypted to a temp file with a random salt and nonce, then uploaded with custom S3 metadata (`x-amz-meta-furman-*`) that records the encryption parameters
2. **Download** — Furman detects the metadata on download and prompts for the decryption password automatically
3. **Preview / Edit** (F3 / F4) — encrypted files are detected and a password prompt appears before the file is downloaded and decrypted

### Enabling Encryption

- **Per-profile default** — in the S3 connection dialog (or when editing a saved profile), check **"Client-side encryption by default"**. Furman will prompt for a password on every upload to that bucket.
- **On-demand** — when downloading encrypted files, Furman detects the encryption metadata and prompts for the password automatically. No configuration needed.

### Encryption Indicator

Files that have been client-side encrypted show a lock icon in the file listing when the cursor passes over them.

### Encryption Settings

When client-side encryption is enabled for a profile, expand **Encryption Settings** in the connection dialog to configure:

| Setting | Options | Default |
|---------|---------|---------|
| **Cipher** | AES-256-GCM, ChaCha20-Poly1305 | AES-256-GCM |
| **KDF Memory** | 8 MiB, 19 MiB, 64 MiB, 128 MiB | 19 MiB |
| **KDF Iterations** | 1, 2, 4, 8 | 2 |
| **KDF Parallelism** | 1, 2, 4 | 1 |
| **Auto-encrypt min size** | Always, 1 KB, 10 KB, 100 KB, 1 MB | Always |
| **Extension filter** | Comma-separated list (empty = all) | All files |
| **Secure temp cleanup** | Overwrite temp files with zeros before deleting | Off |

Higher KDF values make brute-force attacks harder but slow down encryption/decryption. The auto-encrypt threshold skips the password prompt when all selected files are below the given size. Extension filtering only triggers encryption for files matching the listed extensions.

### Technical Details

| Parameter | Value |
|-----------|-------|
| Cipher | AES-256-GCM or ChaCha20-Poly1305 (configurable) |
| KDF | Argon2id (configurable memory, time, parallelism) |
| Salt | 16 random bytes per file |
| Nonce | 12 random bytes per file |

Encryption metadata (including algorithm and KDF parameters) is stored as custom S3 object metadata and does not modify the object key or require any server-side support. Files encrypted with different settings can coexist in the same bucket — decryption reads all parameters from the object metadata.

## Bucket Configuration

All bucket-level settings are accessible from the Properties dialog when viewing the bucket root (select the bucket entry and press Cmd+I). Settings are organized into tabs.

### General Tab

- **Versioning** — view status (Enabled/Suspended/Disabled), enable or suspend
- **Server-Side Encryption** — view and configure SSE algorithm (AES-256, aws:kms, aws:kms:dsse), KMS key ID (with key picker), bucket key status
- **Object Lock** — enable Object Lock, set default retention mode and period

### Security Tab

- **Public Access Block** — toggle all 4 settings: block public ACLs, ignore public ACLs, block public policy, restrict public buckets
- **Bucket Policy** — JSON editor with validation; save or delete policy

### CORS Tab

- **CORS Configuration** — add, edit, remove CORS rules with per-rule allowed origins, methods, headers, expose headers, and max age

### ACL Tab

- **ACL** — view owner and grants with friendly labels for well-known groups (Everyone, Authenticated Users, Log Delivery). Set canned ACL (private, public-read, etc.)

### Lifecycle Tab

- **Lifecycle Rules** — full CRUD for lifecycle rules including current-version transitions, expiration, noncurrent-version transitions/expiration, and abort incomplete multipart upload settings
- **Incomplete Uploads** — list and abort incomplete multipart uploads (individual or all at once)

### Additional Bucket Settings

Available in the General tab for supported providers:

- **Website Hosting** — configure bucket as a static website with index document, error document, and redirect rules
- **Requester Pays** — toggle requester-pays mode where data transfer costs are billed to the requester
- **Server Access Logging** — enable access logging with target bucket and prefix configuration
- **Object Ownership** — configure Object Ownership settings (BucketOwnerEnforced, BucketOwnerPreferred, ObjectWriter)
- **Bucket Tags** — add, edit, remove bucket-level tags (up to 50)

## Provider Compatibility

Furman auto-detects provider capabilities and adjusts the UI accordingly — features are conditionally shown based on what the provider supports. You can also override any capability per-connection via the **Custom capabilities** section in the connection dialog.

If your provider is missing or has incorrect capabilities, please [open an issue](https://github.com/fenio/furman/issues) with the provider name and which capabilities should be enabled or disabled.

### Capability Matrix

| Capability | AWS | MinIO | B2 | R2 | DO | Linode | Wasabi | GCS |
|---|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
| List Buckets | Y | Y | Y | Y | Y | — | Y | Y |
| Versioning | Y | Y | — | — | — | Y | Y | Y |
| Lifecycle Rules | Y | Y | Y | — | Y | Y | — | Y |
| CORS | Y | — | Y | — | Y | Y | — | Y |
| Bucket Policy | Y | Y | — | — | — | — | Y | — |
| ACL | Y | — | — | — | Y | Y | Y | Y |
| Public Access Block | Y | — | — | — | — | — | — | — |
| Server-Side Encryption | Y | Y | — | — | — | — | — | Y |
| Glacier Restore | Y | — | — | — | — | — | — | — |
| Presigned URLs | Y | Y | Y | Y | Y | Y | Y | Y |
| Object Metadata | Y | Y | Y | Y | Y | Y | Y | Y |
| Object Tags | Y | Y | — | — | — | — | Y | — |
| Bucket Tags | Y | Y | — | — | — | — | Y | Y |
| Multipart Cleanup | Y | Y | Y | Y | Y | Y | Y | Y |
| Website Hosting | Y | — | — | — | — | — | — | — |
| Requester Pays | Y | — | — | — | — | — | — | — |
| Object Ownership | Y | — | — | — | — | — | — | — |
| Access Logging | Y | — | — | — | — | — | — | — |
| Object Lock | Y | Y | — | — | — | — | Y | — |
| Storage Classes | All | STD | STD | STD | STD | STD | STD | STD, NEARLINE, COLDLINE, ARCHIVE |

**Y** = supported, **—** = not supported, **STD** = STANDARD only, **All** = STANDARD, STANDARD_IA, ONEZONE_IA, INTELLIGENT_TIERING, GLACIER, GLACIER_IR, DEEP_ARCHIVE

Providers not listed above (imported from the Cyberduck database) default to all capabilities enabled. Use the Custom capabilities UI to disable features that don't work with your provider.
